<!DOCTYPE html>
<html lang="th">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>SOS Emergency Tool Modern</title>
    <link href="https://fonts.googleapis.com/css2?family=Prompt:wght@300;400;600&display=swap" rel="stylesheet">
    <style>
        /* --- Modern Base Setup --- */
        * { box-sizing: border-box; -webkit-tap-highlight-color: transparent; }
        body {
            font-family: 'Prompt', sans-serif;
            margin: 0; padding: 20px;
            background-color: #f0f2f5; /* ‡∏û‡∏∑‡πâ‡∏ô‡∏´‡∏•‡∏±‡∏á‡∏™‡∏µ‡∏™‡∏ß‡πà‡∏≤‡∏á‡πÅ‡∏ö‡∏ö WordPress */
            color: #1c1e21;
            display: flex; justify-content: center;
        }
        .container {
            width: 100%; max-width: 480px;
            background-color: #ffffff;
            padding: 30px 20px;
            border-radius: 20px;
            box-shadow: 0 10px 25px rgba(0,0,0,0.1); /* ‡πÄ‡∏á‡∏≤‡∏ü‡∏∏‡πâ‡∏á‡πÜ ‡∏î‡∏π‡πÅ‡∏û‡∏á */
            text-align: center;
        }

        h2 { color: #d32f2f; margin: 0 0 20px 0; font-weight: 600; }

        /* --- Status Text --- */
        .status-text {
            display: inline-block;
            padding: 5px 15px;
            background: #eee;
            border-radius: 50px;
            font-size: 14px;
            margin-bottom: 20px;
            color: #666;
        }

        /* --- ‡∏™‡πà‡∏ß‡∏ô‡πÅ‡∏™‡∏î‡∏á‡∏ú‡∏•‡∏û‡∏¥‡∏Å‡∏±‡∏î (‡∏™‡πÑ‡∏ï‡∏•‡πå Modern Card) --- */
        .coord-display {
            background-color: #f8f9fa;
            padding: 15px;
            border-radius: 12px;
            border: 1px solid #e1e4e8;
            margin-bottom: 12px;
        }
        .coord-label { font-size: 12px; color: #65676b; display: block; }
        .coord-value { font-size: 24px; font-weight: bold; color: #1a73e8; }

        /* --- ‡∏õ‡∏∏‡πà‡∏°‡∏Å‡∏î (Modern Buttons) --- */
        .btn {
            display: flex; align-items: center; justify-content: center;
            width: 100%; padding: 16px 10px; margin-bottom: 12px;
            border: none; border-radius: 12px;
            font-family: 'Prompt', sans-serif; font-size: 18px; font-weight: 600;
            cursor: pointer; text-decoration: none; transition: 0.2s;
        }
        .btn:active { transform: scale(0.98); opacity: 0.9; }

        #btn-locate { background-color: #1a73e8; color: white; }
        #btn-copy-link { background-color: #34a853; color: white; display: none; } /* ‡∏õ‡∏∏‡πà‡∏°‡∏Å‡πä‡∏≠‡∏õ‡∏õ‡∏µ‡πâ‡∏•‡∏¥‡∏á‡∏Å‡πå */
        #btn-copy { background-color: #fff; color: #1a73e8; border: 2px solid #1a73e8; font-size: 14px; padding: 10px; }
        #btn-camera { background-color: #8e44ad; color: white; }
        #btn-call { background-color: #d32f2f; color: white; font-size: 22px; margin-top: 20px; box-shadow: 0 4px 12px rgba(211,47,47,0.3); }

        /* --- Message & Preview Boxes --- */
        #police-message-box, #photo-preview-box {
            margin-top: 20px; padding: 15px;
            border-radius: 12px; font-size: 15px;
            background-color: #fff9c4; border: 1px solid #ffe082; color: #856404;
            text-align: left; line-height: 1.5;
        }
        
        #photo-gallery {
            display: grid; grid-template-columns: repeat(3, 1fr); gap: 10px; margin-top: 15px;
        }
        .thumbnail { width: 100%; aspect-ratio: 1; object-fit: cover; border-radius: 8px; border: 1px solid #ddd; }
        #btn-download { background-color: #607d8b; color: white; margin-top: 10px; font-size: 14px; }

    </style>
</head>
<body>

    <div class="container">
        <h2>üö® ‡∏®‡∏π‡∏ô‡∏¢‡πå‡πÅ‡∏à‡πâ‡∏á‡πÄ‡∏´‡∏ï‡∏∏‡∏â‡∏∏‡∏Å‡πÄ‡∏â‡∏¥‡∏ô</h2>
        
        <span id="status-display" class="status-text">‡∏™‡∏ñ‡∏≤‡∏ô‡∏∞: ‡∏£‡∏≠‡∏Å‡∏≤‡∏£‡∏Ñ‡πâ‡∏ô‡∏´‡∏≤‡∏ï‡∏≥‡πÅ‡∏´‡∏ô‡πà‡∏á</span>

        <div class="coord-display">
            <span class="coord-label">‡∏•‡∏∞‡∏ï‡∏¥‡∏à‡∏π‡∏î (Latitude)</span>
            <span id="lat-value" class="coord-value">--.------</span>
        </div>
        <div class="coord-display">
            <span class="coord-label">‡∏•‡∏≠‡∏á‡∏à‡∏¥‡∏à‡∏π‡∏î (Longitude)</span>
            <span id="lon-value" class="coord-value">--.------</span>
        </div>

        <button id="btn-locate" class="btn">üìç ‡∏Ñ‡πâ‡∏ô‡∏´‡∏≤‡∏ï‡∏≥‡πÅ‡∏´‡∏ô‡πà‡∏á‡∏õ‡∏±‡∏à‡∏à‡∏∏‡∏ö‡∏±‡∏ô</button>

        <button id="btn-copy-link" class="btn">üîó ‡∏Ñ‡∏±‡∏î‡∏•‡∏≠‡∏Å‡∏•‡∏¥‡∏á‡∏Å‡πå‡πÅ‡∏ú‡∏ô‡∏ó‡∏µ‡πà (‡∏™‡πà‡∏á Line)</button>

        <button id="btn-copy" class="btn">üìã ‡∏Ñ‡∏±‡∏î‡∏•‡∏≠‡∏Å‡∏û‡∏¥‡∏Å‡∏±‡∏î‡∏Ç‡πâ‡∏≠‡∏Ñ‡∏ß‡∏≤‡∏°</button>

        <div id="police-message-box">
             <strong>‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö‡πÅ‡∏à‡πâ‡∏á‡πÄ‡∏à‡πâ‡∏≤‡∏´‡∏ô‡πâ‡∏≤‡∏ó‡∏µ‡πà:</strong>
             <p id="address-detail" style="margin: 10px 0 0 0;">‡πÇ‡∏õ‡∏£‡∏î‡∏Å‡∏î‡∏Ñ‡πâ‡∏ô‡∏´‡∏≤‡∏ï‡∏≥‡πÅ‡∏´‡∏ô‡πà‡∏á...</p>
        </div>

        <hr style="border: 0; border-top: 1px solid #eee; margin: 25px 0;">

        <button id="btn-camera" class="btn">üì∏ ‡∏ñ‡πà‡∏≤‡∏¢‡∏£‡∏π‡∏õ‡∏´‡∏•‡∏±‡∏Å‡∏ê‡∏≤‡∏ô (‡∏Å‡∏î‡∏ã‡πâ‡∏≥‡πÄ‡∏û‡∏∑‡πà‡∏≠‡πÄ‡∏û‡∏¥‡πà‡∏°)</button>
        <input type="file" id="cameraInput" accept="image/*" capture="camera" style="display: none;">
        
        <div id="photo-preview-box">
             <span id="photo-status" style="display:block; text-align:center;">‡∏¢‡∏±‡∏á‡πÑ‡∏°‡πà‡∏°‡∏µ‡∏†‡∏≤‡∏û‡∏ñ‡πà‡∏≤‡∏¢</span>
             <div id="photo-gallery"></div> 
             <a id="btn-download" class="btn" href="#" style="display: none;" onclick="return handleDownload(event)">
                 ‚¨áÔ∏è ‡∏î‡∏≤‡∏ß‡∏ô‡πå‡πÇ‡∏´‡∏•‡∏î‡∏†‡∏≤‡∏û‡∏ó‡∏±‡πâ‡∏á‡∏´‡∏°‡∏î (<span id="file-count">0</span>)
             </a>
        </div>

        <a id="btn-call" class="btn" href="#" onclick="return confirmCall(event)">üìû ‡πÇ‡∏ó‡∏£ 191 ‡∏ó‡∏±‡∏ô‡∏ó‡∏µ</a>
    </div>

    <script>
        // --- ‡∏™‡πà‡∏ß‡∏ô‡∏ó‡∏µ‡πà‡πÄ‡∏û‡∏¥‡πà‡∏°/‡πÅ‡∏Å‡πâ‡πÑ‡∏Ç: ‡∏£‡∏∞‡∏ö‡∏ö‡∏Å‡πä‡∏≠‡∏õ‡∏õ‡∏µ‡πâ‡∏•‡∏¥‡∏á‡∏Å‡πå ---
        let mapURL = ""; 

        document.getElementById('btn-locate').addEventListener('click', getLocation);
        document.getElementById('btn-copy').addEventListener('click', copyCoords);
        document.getElementById('btn-copy-link').addEventListener('click', copyMapURL); // ‡∏ú‡∏π‡∏Å‡∏ü‡∏±‡∏á‡∏Å‡πå‡∏ä‡∏±‡∏ô‡∏õ‡∏∏‡πà‡∏°‡πÉ‡∏´‡∏°‡πà
        document.getElementById('btn-camera').addEventListener('click', triggerCamera);
        document.getElementById('cameraInput').addEventListener('change', handlePhotoCapture);

        let currentLat = null;
        let currentLon = null;
        let capturedFiles = [];

        function getLocation() {
            const statusDisplay = document.getElementById('status-display');
            const latValue = document.getElementById('lat-value');
            const lonValue = document.getElementById('lon-value');
            const addressDetail = document.getElementById('address-detail');
            const btnCopyLink = document.getElementById('btn-copy-link');
            
            statusDisplay.textContent = 'üõ∞Ô∏è ‡∏Å‡∏≥‡∏•‡∏±‡∏á‡∏Ñ‡πâ‡∏ô‡∏´‡∏≤‡∏ï‡∏≥‡πÅ‡∏´‡∏ô‡πà‡∏á...';
            
            if (!navigator.geolocation) {
                statusDisplay.textContent = '‚ùå ‡πÑ‡∏°‡πà‡∏£‡∏≠‡∏á‡∏£‡∏±‡∏ö GPS';
                return;
            }

            navigator.geolocation.getCurrentPosition(success, error, {
                enableHighAccuracy: true, timeout: 15000, maximumAge: 0
            });

            function success(position) {
                currentLat = position.coords.latitude.toFixed(6);
                currentLon = position.coords.longitude.toFixed(6);
                
                statusDisplay.textContent = '‚úÖ ‡∏£‡∏∞‡∏ö‡∏∏‡∏û‡∏¥‡∏Å‡∏±‡∏î‡∏™‡∏≥‡πÄ‡∏£‡πá‡∏à';
                statusDisplay.style.background = "#e8f5e9";
                statusDisplay.style.color = "#2e7d32";
                latValue.textContent = currentLat;
                lonValue.textContent = currentLon;
                
                // ‡∏™‡∏£‡πâ‡∏≤‡∏á‡∏•‡∏¥‡∏á‡∏Å‡πå‡πÅ‡∏ú‡∏ô‡∏ó‡∏µ‡πà (‡πÄ‡∏û‡∏¥‡πà‡∏°‡πÉ‡∏´‡∏°‡πà)
                mapURL = `https://www.google.com/maps?q=${currentLat},${currentLon}`;
                btnCopyLink.style.display = "flex"; // ‡πÇ‡∏ä‡∏ß‡πå‡∏õ‡∏∏‡πà‡∏°‡∏Å‡πä‡∏≠‡∏õ‡∏õ‡∏µ‡πâ‡∏•‡∏¥‡∏á‡∏Å‡πå

                // Geocoding (‡∏î‡∏∂‡∏á‡∏ó‡∏µ‡πà‡∏≠‡∏¢‡∏π‡πà)
                fetch(`https://nominatim.openstreetmap.org/reverse?format=json&lat=${currentLat}&lon=${currentLon}&accept-language=th`)
                    .then(res => res.json())
                    .then(data => {
                        let addr = data.display_name || "‡πÑ‡∏°‡πà‡∏û‡∏ö‡∏ó‡∏µ‡πà‡∏≠‡∏¢‡∏π‡πà‡∏ä‡∏±‡∏î‡πÄ‡∏à‡∏ô";
                        addressDetail.innerHTML = `üìç <strong>‡∏ó‡∏µ‡πà‡∏≠‡∏¢‡∏π‡πà:</strong> ${addr}<br><br><strong>‡πÅ‡∏à‡πâ‡∏á 191:</strong> "‡∏ú‡∏°/‡∏î‡∏¥‡∏â‡∏±‡∏ô ‡∏≠‡∏¢‡∏π‡πà‡∏ó‡∏µ‡πà ${addr} ‡∏û‡∏¥‡∏Å‡∏±‡∏î ${currentLat}, ${currentLon}"`;
                    });
            }

            function error(err) {
                statusDisplay.textContent = '‚ùå ‡∏û‡∏¥‡∏Å‡∏±‡∏î‡∏•‡πâ‡∏°‡πÄ‡∏´‡∏•‡∏ß: ' + err.message;
            }
        }

        // ‡∏ü‡∏±‡∏á‡∏Å‡πå‡∏ä‡∏±‡∏ô‡∏Ñ‡∏±‡∏î‡∏•‡∏≠‡∏Å‡∏•‡∏¥‡∏á‡∏Å‡πå‡πÅ‡∏ú‡∏ô‡∏ó‡∏µ‡πà (‡πÄ‡∏û‡∏¥‡πà‡∏°‡πÉ‡∏´‡∏°‡πà)
        function copyMapURL() {
            if (mapURL) {
                navigator.clipboard.writeText(mapURL).then(() => {
                    const btn = document.getElementById('btn-copy-link');
                    const originalText = btn.innerHTML;
                    btn.innerHTML = "‚úÖ ‡∏Ñ‡∏±‡∏î‡∏•‡∏≠‡∏Å‡∏•‡∏¥‡∏á‡∏Å‡πå‡∏™‡∏≥‡πÄ‡∏£‡πá‡∏à!";
                    setTimeout(() => { btn.innerHTML = originalText; }, 2000);
                });
            }
        }

        function copyCoords() {
            if (currentLat && currentLon) {
                const text = `‡∏û‡∏¥‡∏Å‡∏±‡∏î: ${currentLat}, ${currentLon}`;
                navigator.clipboard.writeText(text).then(() => alert('‡∏Ñ‡∏±‡∏î‡∏•‡∏≠‡∏Å‡∏û‡∏¥‡∏Å‡∏±‡∏î‡∏Ç‡πâ‡∏≠‡∏Ñ‡∏ß‡∏≤‡∏°‡πÅ‡∏•‡πâ‡∏ß'));
            } else {
                alert('‡πÇ‡∏õ‡∏£‡∏î‡∏Å‡∏î‡∏Ñ‡πâ‡∏ô‡∏´‡∏≤‡∏ï‡∏≥‡πÅ‡∏´‡∏ô‡πà‡∏á‡∏Å‡πà‡∏≠‡∏ô');
            }
        }

        function confirmCall(event) {
            event.preventDefault(); 
            if (confirm("‡∏¢‡∏∑‡∏ô‡∏¢‡∏±‡∏ô‡πÇ‡∏ó‡∏£ 191?")) window.location.href = "tel:191";
        }

        function triggerCamera() { document.getElementById('cameraInput').click(); }

        function handlePhotoCapture(event) {
            const file = event.target.files[0];
            if (file) {
                capturedFiles.push(file);
                const url = URL.createObjectURL(file);
                const img = document.createElement('img');
                img.src = url;
                img.classList.add('thumbnail');
                document.getElementById('photo-gallery').appendChild(img);
                document.getElementById('photo-status').textContent = `‚úÖ ‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡πÅ‡∏•‡πâ‡∏ß ${capturedFiles.length} ‡∏†‡∏≤‡∏û`;
                document.getElementById('file-count').textContent = capturedFiles.length;
                document.getElementById('btn-download').style.display = 'flex';
                
                // Auto-Download ‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡∏•‡∏á‡πÄ‡∏Ñ‡∏£‡∏∑‡πà‡∏≠‡∏á‡∏ó‡∏±‡∏ô‡∏ó‡∏µ (‡∏ï‡∏≤‡∏°‡∏ó‡∏µ‡πà‡∏Ñ‡∏∏‡∏¢‡∏Å‡∏±‡∏ô‡∏£‡∏≠‡∏ö‡∏Å‡πà‡∏≠‡∏ô)
                const autoSave = document.createElement('a');
                autoSave.href = url;
                autoSave.download = `SOS_IMG_${Date.now()}.jpg`;
                autoSave.click();
                
                event.target.value = null; 
            }
        }

        function handleDownload(event) {
            event.preventDefault();
            capturedFiles.forEach((file, i) => {
                const a = document.createElement('a');
                a.href = URL.createObjectURL(file);
                a.download = `Emergency_Photo_${i+1}.jpg`;
                a.click();
            });
            return false;
        }
    </script>
</body>
</html>
